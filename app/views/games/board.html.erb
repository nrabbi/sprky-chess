<div class="container">
  <br />
    <div id="chessboard" data-game-id="<%= @current_game.id %>">
      <% col = ["A", "B", "C", "D", "E", "F", "G", "H"]
      row_index = 7
      col_index = 0 %>

      <!--
        Chess Coordinates (x, y)
        ------------------------------------
        top-left(0, 7), top-right(7,7)
        bottom-left(0, 0), bottom-right(7,0)
      -->

      <table>
        <% 8.times do %>
          <tr>
            <% 8.times do %>
              <td class="square" data-x="<%= col_index %>" data-y="<%= row_index %>">
                <div><%= col[col_index] + (row_index+1).to_s %></div>
                <% piece = get_piece_at(col_index, row_index) %>
                <% if piece %> 
                  <div class="pieces"><%= piece.html_icon.html_safe %></div>
                <% end %>
              </td>
              <% col_index += 1 %>
              
            <% end %>
          </tr>

          <% row_index -= 1 %>
          <% col_index = 0 %>
        <% end %>
      </table>
      <br />
      <div class="col-xs-2 move-button">
      <br />
        <%= link_to "Add a Move", new_game_move_path(@game), class: 'btn btn-primary' %>
      </div>
      <div class="col-xs-8 moves-list">
      <h3><%= @game.name %> moves</h3>
      <ul>
        <% @game.moves.each do |move| %>
          <li class="text-right">
            From: <%= move.from %>
            To: <%= move.to %>
          </li>
          <% end %>
        </ul>
      </div>
    </div>
    
</div>

<script>
  $(document).ready(function(){
    var gameId = $('#chessboard').data('game-id');
    var from, to;

    var selectedCount = 0;
    $('.square').click(function(ev){

      var square = $(this);
      square.addClass('selected');
      console.log(square.data('x'), square.data('y'));
      selectedCount++;
      if(selectedCount == 2){
        //  Send

        to =  integerConversion(square.data('x'), square.data('y'));
        var payload = {
          move: {
            game_id: gameId,
            from: from,
            to: to
          }
        };
        console.log(payload);
        $.post('/games/' + gameId + "/moves", payload).success(function(data){
          console.log(data);
        });
        selectedCount = 0;
      }else{
        from = integerConversion(square.data('x'), square.data('y'));
      }

//      console.log(ev.target.attr("x"), ev.target.attr("y"));
    });

    function integerConversion(x, y){
      console.log(y);
      return (y * 8) + x;
    }
  });
</script>